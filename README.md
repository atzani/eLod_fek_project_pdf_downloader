pdfDownloader Documentation

Τι κάνει ο κώδικας

Ο κώδικας pdfDownloader δέχεται ως είσοδο το url ενός pdf αρχείου, με σκοπό να το κάνει λήψη, να το αποθηκεύσει σε συγκεκριμένο φάκελο και τέλος να το μετονομάσει.

Βήματα κώδικα

Η εκτέλεση του κώδικα χωρίζεται στα ακόλουθα τμήματα:

Δημιουργία των αρχικών φακέλων:
ΑΕ: φάκελος για την αποθήκευση των pdf που σχετίζονται με Ανώνυμες Εταιρείες.
ΕΠΕ: φάκελος για την αποθήκευση των pdf που σχετίζονται με Εταιρείες Περιορισμένης Ευθύνης.

Διάβασμα ανά γραμμή του input csv αρχείου: Η κάθε γραμμή του αρχείου περιέχει πληροφορία για την εκτέλεση του κώδικα, η οποία χρησιμοποιείτε για την σύνδεση του κώδικα στην ιστοσελίδα www.et.gr καθώς επίσης και για την ονομασία των φακέλων και τον αρχείων. Η κάθε γραμμή του αρχείου είναι της μορφής:

ΑΦΜ, τύπος εταιρείας, τύπος ΦΕΚ, Θέμα ΦΕΚ, Ημερομηνία δημοσίευσης ΦΕΚ, Αρ. ΦΕΚ, pdf URL

Έλεγχος τύπου εταιρείας: Ελέγχεται αν η εταιρεία είναι ΑΕ ή ΕΠΕ και αντίστοιχα ο κώδικας επιλέγει ως root directory τον φάκελο ΑΕ ή τον ΕΠΕ.

Δημιουργία φακέλου αποθήκευσης pdf: Αφού ο κώδικας επιλέξει το root directory δημιουργεί μέσα σε αυτό τον φάκελο στον οποίο θα αποθηκευτεί το pdf αρχείο. Η δημιουργία του γίνεται από την κλάση directoryCreator(), οποία παίρνει ως ορίσματα την διαδρομή του root directory και την διαδρομή του φακέλου αποθήκευσης του pdf. H διαδρομή του φακέλου αποθήκευσης ακολουθεί την δομή:

 τύπος εταιρείας/ΑΦΜ/τύπος ΦΕΚ/Θέμα ΦΕΚ/

Αρχικοποίηση ονομασίας του αρχείου μετά την λήψη του: Στόχος είναι το pdf αρχείο μετά την λήψη του να μετονομαστεί από την αρχική ονομασία document.pdf στην επιθυμητή ονομασία η οποία είναι της μορφής:

 ημερομηνία δημοσίευσης_αρ. ΦΕΚ_ΑΦΜ.pdf

Έλεγχος ύπαρξης αρχείου: Κατά τις δοκιμές που έγιναν παρατηρήθηκε ότι σε αρκετές περιπτώσεις τα προς λήψη αρχεία, είχαν ήδη δημιουργηθεί στο σύστημα και ο κώδικας το μόνο που έκανε ήταν να τα ξανακάνει λήψη, σβήνοντας το ήδη υπάρχον αρχείο και αποθηκεύοντας στην θέση του το νέο με το ίδιο όνομα. Η διαδικασία αυτή εκτός από πόρους τους οποίους χρησιμοποιούσε άσκοπα, καθυστερούσε και την όλη διαδικασία. Για τον λόγο αυτό ο κώδικας προγραμματίστηκε να ελέγχει το κάθε αρχείο προς λήψη, με βάση την τελική του ονομασία, αν ήδη υπάρχει στο σύστημα και ανάλογα να προχωράει στην λήψη του ή να προχωράει στην επόμενη γραμμή.

Λήψη pdf: Στην περίπτωση που το αρχείο δεν υπάρχει στο σύστημα ο κώδικας προχωράει στην λήψη του. Η λήψη του γίνεται από την κλάση pdfDownload(). H κλάση αυτή αυτό που κάνει είναι να συνδέεται μέσω του FireFox στο site και να κατεβάζει το αντίστοιχο αρχείο, στον επιθυμητό φάκελο. Για να μπορέσει η λήψη να γίνει από τον κώδικα μέσω του FireFox είναι απαραίτητο να δημιουργηθεί FireFox profile με τις επιθυμητές επιλογές. Αυτό γίνεται από την κλάση  fireFoxProfile(), η οποία παίρνει ως είσοδο την διαδρομή του αρχείου αποθήκευσης που επιθυμούμε για το εκάστοτε pdf, και επιστρέφει το fireFox profile που δημιουργήθηκε Στην περίπτωση που ο κώδικας εκτελείται σε linux server ο οποίος λειτουργεί χωρίς την ύπαρξη οθόνης, για την ομαλή εκτέλεσή του, καθώς το fireFox απαιτεί την δημιουργία παραθύρου απεικόνισης, χρησιμοποιείται η εφαρμογή xvfb. Η εφαρμογή αυτό που κάνει είναι να δημιουργεί μια “εικονική” οθόνη ώστε να μπορέσει να λειτουργήσει ο fireFox browser. Για να μπορέσει να λειτουργήσει ο κώδικας καλώντας το firefox σε server εκτός από την δημιουργία firefox profile είναι απαραίτητο να δημιουργηθεί και firefox binary. H δημιουργία του γίνεται από την κλάση fireFoxBinary(), η οποία παίρνει ως είσοδο την διαδρομή του φακέλου στον οποίο είναι αποθηκευμένο το αρχείο του firefox, καθώς και τον αριθμό ονομασίας της “εικονικής” οθόνης.

Μετονομασία αρχείου: Όπως αναφέρθηκε και παραπάνω το τελικό βήμα εκτέλεσης του κώδικα είναι η μετονομασία του αρχείου που έγινε λήψη από document στο επιθυμητό. Για την μετονομασία χρησιμοποιούνται δυο κλάσεις:
 Η κλάση getTheNewestFile(), για να βρεθεί το τελευταίο χρονικά αρχείο το οποίο έγινε λήψη στον φάκελο, έτσι ώστε να μην μετονομάσουμε λάθος αρχείο χάνοντας δεδομένα.
Η κλάση fileRenamer(), ώστε να μετονομαστεί το τελευταίο χρονικά ληφθέν αρχείο στο επιθυμητό όνομα, όπως αυτό ορίζεται παραπάνω.




